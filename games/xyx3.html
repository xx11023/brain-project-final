<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤§è„‘åŠŸèƒ½é—®ç­”æ¸¸æˆ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Microsoft Yahei", "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    /* æ¸¸æˆæ ‡é¢˜å’Œè¯´æ˜ */
    .game-header {
      text-align: center;
      margin-bottom: 30px;
      width: 100%;
      max-width: 900px;
    }

    .game-title {
      font-size: 2.8rem;
      color: #ffd700;
      text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
      margin-bottom: 10px;
    }

    .game-subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      margin-bottom: 20px;
    }

    /* æ¸¸æˆä¿¡æ¯é¢æ¿ */
    .game-info {
      display: flex;
      justify-content: space-between;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 15px 25px;
      margin-bottom: 25px;
      width: 100%;
      max-width: 900px;
    }

    .info-item {
      text-align: center;
    }

    .info-label {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 1.8rem;
      font-weight: bold;
      color: #ffd700;
    }

    /* æ¸¸æˆä¸»å®¹å™¨ */
    .game-container {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 900px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
    }

    /* é—®é¢˜æ˜¾ç¤ºåŒºåŸŸ */
    .question-container {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
    }

    .question-number {
      font-size: 1rem;
      color: #a8daff;
      margin-bottom: 10px;
    }

    .question-text {
      font-size: 1.5rem;
      line-height: 1.6;
      margin-bottom: 20px;
      color: #ffd700;
    }

    .question-image {
      width: 100%;
      max-width: 400px;
      border-radius: 10px;
      margin: 15px auto;
      display: block;
      border: 3px solid rgba(255, 255, 255, 0.1);
    }

    /* ç­”æ¡ˆé€‰é¡¹åŒºåŸŸ */
    .answers-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      margin-bottom: 30px;
    }

    @media (min-width: 768px) {
      .answers-container {
        grid-template-columns: 1fr 1fr;
      }
    }

    .answer-option {
      background: rgba(255, 255, 255, 0.15);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 18px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
    }

    .answer-option:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-3px);
    }

    .answer-option.selected {
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      color: #333;
      font-weight: bold;
      border-color: #ffd700;
    }

    .answer-option.correct {
      background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
      color: white;
      border-color: #4ecdc4;
    }

    .answer-option.wrong {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
      color: white;
      border-color: #ff6b6b;
    }

    .option-letter {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 30px;
      height: 30px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      margin-right: 15px;
      font-weight: bold;
    }

    .answer-option.selected .option-letter {
      background: #333;
      color: #ffd700;
    }

    /* æŒ‰é’®æ ·å¼ */
    .game-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    .game-btn {
      padding: 12px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .game-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .game-btn:active {
      transform: scale(0.98);
    }

    .game-btn.next {
      background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
    }

    .game-btn.submit {
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      color: #333;
    }

    .game-btn.reset {
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
      color: #333;
    }

    .game-btn.back {
      background: linear-gradient(135deg, #a8daff 0%, #a8daff 100%);
      color: #333;
    }

    /* æ¸¸æˆæ¶ˆæ¯ */
    .game-message {
      text-align: center;
      font-size: 1.4rem;
      font-weight: bold;
      min-height: 50px;
      color: #ffd700;
      margin: 20px 0;
      padding: 10px;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.2);
    }

    /* å®Œæˆç•Œé¢ */
    .completion-screen {
      text-align: center;
      display: none;
      padding: 40px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 20px;
      margin-top: 20px;
    }

    .completion-screen.show {
      display: block;
    }

    .completion-icon {
      font-size: 5rem;
      margin-bottom: 20px;
    }

    .completion-title {
      font-size: 2.5rem;
      color: #ffd700;
      margin-bottom: 20px;
    }

    .completion-stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 30px 0;
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px 25px;
      border-radius: 15px;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #ffd700;
    }

    .stat-label {
      font-size: 1rem;
      opacity: 0.8;
    }

    .score-bar {
      width: 100%;
      height: 30px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      margin: 30px 0;
      overflow: hidden;
      position: relative;
    }

    .score-fill {
      height: 100%;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      width: 0%;
      border-radius: 15px;
      transition: width 1s ease;
    }

    .score-text {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #333;
    }

    /* è¿›åº¦æ¡ */
    .progress-container {
      width: 100%;
      height: 10px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 5px;
      margin: 20px 0;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
      width: 0%;
      border-radius: 5px;
      transition: width 0.5s ease;
    }

    /* åé¦ˆåŠ¨ç”» */
    @keyframes correctPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes wrongShake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    .feedback-correct {
      animation: correctPulse 0.5s;
    }

    .feedback-wrong {
      animation: wrongShake 0.5s;
    }

    /* æ»šåŠ¨æ¡ç¾åŒ– */
    ::-webkit-scrollbar {
      width: 10px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(255, 215, 0, 0.5);
      border-radius: 5px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 215, 0, 0.8);
    }
  </style>
</head>
<body>
  <!-- æ¸¸æˆæ ‡é¢˜å’Œè¯´æ˜ -->
  <div class="game-header">
    <h1 class="game-title">ğŸ§  å¤§è„‘åŠŸèƒ½é—®ç­”æ¸¸æˆ</h1>
    <p class="game-subtitle">å›ç­”å…³äºå¤§è„‘åŠŸèƒ½çš„å„ç§é—®é¢˜ï¼ŒæŒ‘æˆ˜ä½ çš„å¤§è„‘çŸ¥è¯†ï¼Œçœ‹çœ‹ä½ èƒ½ç­”å¯¹å¤šå°‘é¢˜</p>
  </div>

  <!-- æ¸¸æˆä¿¡æ¯é¢æ¿ -->
  <div class="game-info">
    <div class="info-item">
      <div class="info-label">å½“å‰åˆ†æ•°</div>
      <div class="info-value" id="currentScore">0</div>
    </div>
    <div class="info-item">
      <div class="info-label">é—®é¢˜</div>
      <div class="info-value" id="questionCounter">1/10</div>
    </div>
    <div class="info-item">
      <div class="info-label">æ­£ç¡®ç‡</div>
      <div class="info-value" id="accuracy">0%</div>
    </div>
  </div>

  <!-- æ¸¸æˆä¸»å®¹å™¨ -->
  <div class="game-container">
    <!-- é—®é¢˜æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="question-container">
      <div class="question-number" id="questionNumber">é—®é¢˜ #1</div>
      <div class="question-text" id="questionText">
        åŠ è½½é—®é¢˜ä¸­...
      </div>
      <img class="question-image" id="questionImage" src="" alt="" style="display:none;">
    </div>

    <!-- ç­”æ¡ˆé€‰é¡¹åŒºåŸŸ -->
    <div class="answers-container" id="answersContainer">
      <!-- ç­”æ¡ˆé€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
    </div>

    <!-- è¿›åº¦æ¡ -->
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- æ¸¸æˆæ¶ˆæ¯ -->
    <div class="game-message" id="gameMessage">
      è¯·é€‰æ‹©ä½ è®¤ä¸ºæ­£ç¡®çš„ç­”æ¡ˆ
    </div>

    <!-- æ¸¸æˆæŒ‰é’® -->
    <div class="game-buttons">
      <button class="game-btn reset" id="resetGameBtn">é‡æ–°å¼€å§‹</button>
      <button class="game-btn back" id="backBtn">è¿”å›ä¸»é¡µé¢</button>
      <button class="game-btn submit" id="submitBtn" disabled>æäº¤ç­”æ¡ˆ</button>
      <button class="game-btn next" id="nextBtn" style="display:none;">ä¸‹ä¸€é¢˜</button>
    </div>

    <!-- å®Œæˆç•Œé¢ -->
    <div class="completion-screen" id="completionScreen">
      <div class="completion-icon">ğŸ†</div>
      <h2 class="completion-title" id="completionTitle">æµ‹è¯•å®Œæˆï¼</h2>

      <!-- åˆ†æ•°æ¡ -->
      <div class="score-bar">
        <div class="score-fill" id="scoreFill"></div>
        <div class="score-text" id="scoreText">0%</div>
      </div>

      <!-- ç»Ÿè®¡æ•°æ® -->
      <div class="completion-stats">
        <div class="stat-item">
          <div class="stat-value" id="finalScore">0</div>
          <div class="stat-label">æœ€ç»ˆåˆ†æ•°</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="correctAnswers">0</div>
          <div class="stat-label">æ­£ç¡®é¢˜æ•°</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="finalAccuracy">0%</div>
          <div class="stat-label">æ­£ç¡®ç‡</div>
        </div>
      </div>

      <!-- è¯„çº§ä¿¡æ¯ -->
      <div id="ratingMessage" style="margin: 25px 0; font-size: 1.2rem;"></div>

      <!-- çŸ¥è¯†æ€»ç»“ -->
      <div id="knowledgeSummary" style="text-align: left; background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; margin: 25px 0;">
        <h3 style="color: #a8daff; margin-bottom: 15px;">ğŸ“š çŸ¥è¯†æ€»ç»“</h3>
        <div id="summaryContent"></div>
      </div>

      <!-- å®Œæˆç•Œé¢æŒ‰é’® -->
      <div class="game-buttons">
        <button class="game-btn reset" id="playAgainBtn">å†ç©ä¸€æ¬¡</button>
        <button class="game-btn back" id="backBtn2">è¿”å›ä¸»é¡µé¢</button>
      </div>
    </div>
  </div>

  <script>
    // ==================== å¤§è„‘åŠŸèƒ½é—®é¢˜æ•°æ® ====================
    const brainQuestions = [
      {
        id: 1,
        question: "å¤§è„‘çš„å“ªä¸ªéƒ¨åˆ†ä¸»è¦è´Ÿè´£å†³ç­–ã€è®¡åˆ’å’Œè¿åŠ¨æ§åˆ¶ï¼Ÿ",
        options: [
          "é¢å¶",
          "é¡¶å¶",
          "é¢å¶",
          "æ•å¶"
        ],
        correctAnswer: 0,
        explanation: "é¢å¶æ˜¯å¤§è„‘çš„'æŒ‡æŒ¥ä¸­å¿ƒ'ï¼Œè´Ÿè´£é«˜çº§è®¤çŸ¥åŠŸèƒ½ï¼ŒåŒ…æ‹¬å†³ç­–åˆ¶å®šã€é—®é¢˜è§£å†³ã€è®¡åˆ’æ‰§è¡Œã€æƒ…ç»ªè°ƒèŠ‚å’Œè¿åŠ¨æ§åˆ¶ã€‚",
        image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Brain_gyri_and_sulci.svg/300px-Brain_gyri_and_sulci.svg.png"
      },
      {
        id: 2,
        question: "å“ªéƒ¨åˆ†å¤§è„‘è´Ÿè´£å¤„ç†è§†è§‰ä¿¡æ¯ï¼Ÿ",
        options: [
          "é¢å¶",
          "é¡¶å¶",
          "é¢å¶",
          "æ•å¶"
        ],
        correctAnswer: 3,
        explanation: "æ•å¶æ˜¯è§†è§‰ä¿¡æ¯å¤„ç†çš„ä¸­å¿ƒï¼Œæ¥è‡ªçœ¼ç›çš„è§†è§‰ä¿¡å·ç»è¿‡è§†ç¥ç»ä¼ é€’åˆ°æ•å¶çš„åˆçº§è§†è§‰çš®å±‚è¿›è¡Œå¤æ‚å¤„ç†ã€‚",
        image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Brain_gyri_and_sulci.svg/300px-Brain_gyri_and_sulci.svg.png"
      },
      {
        id: 3,
        question: "æµ·é©¬ä½“ä¸»è¦ä¸å“ªç§åŠŸèƒ½ç›¸å…³ï¼Ÿ",
        options: [
          "æƒ…ç»ªå¤„ç†",
          "è®°å¿†å½¢æˆ",
          "è¿åŠ¨åè°ƒ",
          "è¯­è¨€ç†è§£"
        ],
        correctAnswer: 1,
        explanation: "æµ·é©¬ä½“ä½äºé¢å¶å†…ä¾§ï¼Œå¯¹é•¿æœŸè®°å¿†çš„å½¢æˆå’Œç©ºé—´å¯¼èˆªè‡³å…³é‡è¦ã€‚",
        image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Brain_gyri_and_sulci.svg/300px-Brain_gyri_and_sulci.svg.png"
      },
      {
        id: 4,
        question: "å¸ƒæ´›å¡åŒºä½äºå¤§è„‘å“ªä¸ªéƒ¨åˆ†ï¼Ÿ",
        options: [
          "é¢å¶",
          "é¡¶å¶",
          "é¢å¶",
          "æ•å¶"
        ],
        correctAnswer: 0,
        explanation: "å¸ƒæ´›å¡åŒºä½äºå·¦ä¾§é¢å¶ï¼Œè´Ÿè´£è¯­è¨€è¡¨è¾¾å’Œäº§ç”Ÿã€‚æŸä¼¤ä¼šå¯¼è‡´è¿åŠ¨æ€§å¤±è¯­ç—‡ã€‚",
        image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Brain_gyri_and_sulci.svg/300px-Brain_gyri_and_sulci.svg.png"
      },
      {
        id: 5,
        question: "å¤„ç†è§¦è§‰å’Œç©ºé—´ä¿¡æ¯ä¸»è¦æ˜¯å“ªä¸ªè„‘å¶çš„åŠŸèƒ½ï¼Ÿ",
        options: [
          "é¢å¶",
          "é¡¶å¶",
          "é¢å¶",
          "æ•å¶"
        ],
        correctAnswer: 1,
        explanation: "é¡¶å¶ä¸»è¦è´Ÿè´£å¤„ç†æ„Ÿè§‰ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯è§¦è§‰ã€æ¸©åº¦ã€ç–¼ç—›å’Œæœ¬ä½“æ„Ÿè§‰ï¼Œè¿˜å‚ä¸ç©ºé—´å®šä½å’Œæ³¨æ„åŠ›åˆ†é…ã€‚",
        image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Brain_gyri_and_sulci.svg/300px-Brain_gyri_and_sulci.svg.png"
      },
      {
        id: 6,
        question: "æä»æ ¸ä¸»è¦å¤„ç†å“ªç§æƒ…ç»ªï¼Ÿ",
        options: [
          "å¿«ä¹",
          "æ‚²ä¼¤",
          "ææƒ§",
          "æ„¤æ€’"
        ],
        correctAnswer: 2,
        explanation: "æä»æ ¸ä½äºé¢å¶æ·±éƒ¨ï¼Œä¸“é—¨å¤„ç†æƒ…ç»ªååº”ï¼Œç‰¹åˆ«æ˜¯ææƒ§å’Œå¨èƒæ£€æµ‹ã€‚",
        image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Brain_gyri_and_sulci.svg/300px-Brain_gyri_and_sulci.svg.png"
      },
      {
        id: 7,
        question: "å°è„‘çš„ä¸»è¦åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿ",
        options: [
          "æ€è€ƒå†³ç­–",
          "åè°ƒè¿åŠ¨å’Œå¹³è¡¡",
          "å¤„ç†è§†è§‰ä¿¡æ¯",
          "å½¢æˆè®°å¿†"
        ],
        correctAnswer: 1,
        explanation: "å°è„‘ä½äºå¤§è„‘åæ–¹ï¼Œä¸»è¦è´Ÿè´£åè°ƒéšæ„è¿åŠ¨ã€ç»´æŒå§¿åŠ¿å’Œå¹³è¡¡ã€‚",
        image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Brain_gyri_and_sulci.svg/300px-Brain_gyri_and_sulci.svg.png"
      },
      {
        id: 8,
        question: "éŸ¦å°¼å…‹åŒºè´Ÿè´£ä»€ä¹ˆåŠŸèƒ½ï¼Ÿ",
        options: [
          "è¯­è¨€è¡¨è¾¾",
          "è¯­è¨€ç†è§£",
          "è¿åŠ¨æ§åˆ¶",
          "è§†è§‰å¤„ç†"
        ],
        correctAnswer: 1,
        explanation: "éŸ¦å°¼å…‹åŒºä½äºå·¦ä¾§é¢å¶ï¼Œè´Ÿè´£è¯­è¨€ç†è§£ã€‚æŸä¼¤ä¼šå¯¼è‡´æ„Ÿè§‰æ€§å¤±è¯­ç—‡ã€‚",
        image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Brain_gyri_and_sulci.svg/300px-Brain_gyri_and_sulci.svg.png"
      },
      {
        id: 9,
        question: "å¤§è„‘çš„å“ªéƒ¨åˆ†æ§åˆ¶åŸºæœ¬ç”Ÿå‘½åŠŸèƒ½å¦‚å‘¼å¸å’Œå¿ƒè·³ï¼Ÿ",
        options: [
          "å¤§è„‘çš®å±‚",
          "å°è„‘",
          "è„‘å¹²",
          "è¾¹ç¼˜ç³»ç»Ÿ"
        ],
        correctAnswer: 2,
        explanation: "è„‘å¹²ä½äºå¤§è„‘åº•éƒ¨ï¼Œæ§åˆ¶åŸºæœ¬ç”Ÿå‘½åŠŸèƒ½å¦‚å‘¼å¸ã€å¿ƒè·³å’Œè¡€å‹ã€‚",
        image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Brain_gyri_and_sulci.svg/300px-Brain_gyri_and_sulci.svg.png"
      },
      {
        id: 10,
        question: "åˆçº§è¿åŠ¨çš®å±‚ä½äºå“ªä¸ªè„‘å›ï¼Ÿ",
        options: [
          "ä¸­å¤®å‰å›",
          "ä¸­å¤®åå›",
          "è§’å›",
          "æ¢­çŠ¶å›"
        ],
        correctAnswer: 0,
        explanation: "åˆçº§è¿åŠ¨çš®å±‚ä½äºä¸­å¤®å‰å›ï¼Œè´Ÿè´£è®¡åˆ’å’Œæ‰§è¡Œè‡ªä¸»è¿åŠ¨ã€‚",
        image: "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4f/Brain_gyri_and_sulci.svg/300px-Brain_gyri_and_sulci.svg.png"
      }
    ];

    // ==================== æ¸¸æˆçŠ¶æ€å˜é‡ ====================
    let currentQuestionIndex = 0;
    let score = 0;
    let selectedAnswer = null;
    let gameActive = true;
    let correctAnswers = 0;
    let userAnswers = [];

    // ==================== DOMå…ƒç´ å¼•ç”¨ ====================
    const questionNumber = document.getElementById('questionNumber');
    const questionText = document.getElementById('questionText');
    const questionImage = document.getElementById('questionImage');
    const answersContainer = document.getElementById('answersContainer');
    const gameMessage = document.getElementById('gameMessage');
    const currentScore = document.getElementById('currentScore');
    const questionCounter = document.getElementById('questionCounter');
    const accuracy = document.getElementById('accuracy');
    const progressBar = document.getElementById('progressBar');
    const submitBtn = document.getElementById('submitBtn');
    const nextBtn = document.getElementById('nextBtn');
    const completionScreen = document.getElementById('completionScreen');
    const finalScore = document.getElementById('finalScore');
    const correctAnswersElement = document.getElementById('correctAnswers');
    const finalAccuracy = document.getElementById('finalAccuracy');
    const scoreFill = document.getElementById('scoreFill');
    const scoreText = document.getElementById('scoreText');
    const ratingMessage = document.getElementById('ratingMessage');
    const summaryContent = document.getElementById('summaryContent');
    const completionTitle = document.getElementById('completionTitle');

    // ==================== è¿”å›ä¸»é¡µé¢çš„å‡½æ•° ====================
    function returnToMainPage() {
      // è·³è½¬åˆ°æŒ‡å®šçš„ä¸»é¡µURL
      const mainPageUrl = 'index.html';

      // å°è¯•å…³é—­å½“å‰çª—å£ï¼ˆå¦‚æœå…è®¸çš„è¯ï¼‰
      try {
        // é¦–å…ˆå°è¯•ç”¨window.openæ‰“å¼€ä¸»é¡µ
        window.open(mainPageUrl, '_self');

        // å»¶è¿Ÿä¸€å°æ®µæ—¶é—´åå°è¯•å…³é—­å½“å‰çª—å£
        setTimeout(() => {
          // æ£€æŸ¥å½“å‰çª—å£æ˜¯å¦å¯ä»¥è¢«å…³é—­
          if (window.opener) {
            // å¦‚æœæœ‰openerï¼Œè¯´æ˜æ˜¯ä»ä¸»é¡µé¢æ‰“å¼€çš„
            window.close();
          } else {
            // å¦‚æœæ²¡æœ‰openerï¼Œå°è¯•ä½¿ç”¨å…¶ä»–æ–¹å¼
            console.log('è¿”å›ä¸»é¡µé¢æˆåŠŸï¼å¦‚æœå½“å‰çª—å£æ²¡æœ‰è‡ªåŠ¨å…³é—­ï¼Œè¯·æ‰‹åŠ¨å…³é—­ã€‚');
          }
        }, 100);
      } catch (error) {
        // å¦‚æœæ— æ³•è‡ªåŠ¨å…³é—­ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯å¹¶è·³è½¬
        console.log('ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæ— æ³•è‡ªåŠ¨å…³é—­çª—å£ã€‚');
        alert('æ­£åœ¨è¿”å›ä¸»é¡µé¢...è¯·æ‰‹åŠ¨å…³é—­æ­¤æ¸¸æˆçª—å£ã€‚');
        window.location.href = mainPageUrl;
      }
    }

    // ==================== æ¸¸æˆåˆå§‹åŒ– ====================
    function initGame() {
      // é‡ç½®æ¸¸æˆçŠ¶æ€
      currentQuestionIndex = 0;
      score = 0;
      selectedAnswer = null;
      gameActive = true;
      correctAnswers = 0;
      userAnswers = [];

      // æ›´æ–°æ˜¾ç¤º
      currentScore.textContent = '0';
      questionCounter.textContent = '1/10';
      accuracy.textContent = '0%';
      progressBar.style.width = '0%';
      gameMessage.textContent = 'è¯·é€‰æ‹©ä½ è®¤ä¸ºæ­£ç¡®çš„ç­”æ¡ˆ';
      gameMessage.style.color = '#ffd700';

      // éšè—å®Œæˆç•Œé¢
      completionScreen.classList.remove('show');

      // é‡ç½®æŒ‰é’®çŠ¶æ€
      submitBtn.disabled = true;
      submitBtn.style.display = 'block';
      nextBtn.style.display = 'none';

      // åŠ è½½ç¬¬ä¸€ä¸ªé—®é¢˜
      loadQuestion(currentQuestionIndex);
    }

    // ==================== åŠ è½½é—®é¢˜ ====================
    function loadQuestion(index) {
      if (index >= brainQuestions.length) {
        completeGame();
        return;
      }

      const question = brainQuestions[index];

      // æ›´æ–°é—®é¢˜æ˜¾ç¤º
      questionNumber.textContent = `é—®é¢˜ #${question.id}`;
      questionText.textContent = question.question;
      questionCounter.textContent = `${index + 1}/${brainQuestions.length}`;

      // æ›´æ–°è¿›åº¦æ¡
      const progress = ((index) / brainQuestions.length) * 100;
      progressBar.style.width = `${progress}%`;

      // å¦‚æœæœ‰å›¾ç‰‡ï¼Œæ˜¾ç¤ºå›¾ç‰‡
      if (question.image) {
        questionImage.src = question.image;
        questionImage.style.display = 'block';
      } else {
        questionImage.style.display = 'none';
      }

      // ç”Ÿæˆç­”æ¡ˆé€‰é¡¹
      answersContainer.innerHTML = '';
      const optionLetters = ['A', 'B', 'C', 'D'];

      question.options.forEach((option, i) => {
        const answerOption = document.createElement('div');
        answerOption.className = 'answer-option';
        answerOption.innerHTML = `
          <span class="option-letter">${optionLetters[i]}</span>
          <span class="option-text">${option}</span>
        `;
        answerOption.dataset.index = i;

        answerOption.addEventListener('click', () => selectAnswer(i, answerOption));
        answersContainer.appendChild(answerOption);
      });

      // é‡ç½®é€‰æ‹©çŠ¶æ€
      selectedAnswer = null;
      submitBtn.disabled = true;
      submitBtn.style.display = 'block';
      nextBtn.style.display = 'none';
      gameMessage.textContent = 'è¯·é€‰æ‹©ä½ è®¤ä¸ºæ­£ç¡®çš„ç­”æ¡ˆ';
      gameMessage.style.color = '#ffd700';
    }

    // ==================== é€‰æ‹©ç­”æ¡ˆ ====================
    function selectAnswer(index, element) {
      if (!gameActive) return;

      // å–æ¶ˆä¹‹å‰çš„é€‰æ‹©
      const previousSelected = document.querySelector('.answer-option.selected');
      if (previousSelected) {
        previousSelected.classList.remove('selected');
      }

      // é€‰æ‹©æ–°ç­”æ¡ˆ
      selectedAnswer = index;
      element.classList.add('selected');
      submitBtn.disabled = false;
    }

    // ==================== æäº¤ç­”æ¡ˆ ====================
    function submitAnswer() {
      if (selectedAnswer === null || !gameActive) return;

      const question = brainQuestions[currentQuestionIndex];
      const isCorrect = selectedAnswer === question.correctAnswer;

      // è®°å½•ç”¨æˆ·ç­”æ¡ˆ
      userAnswers.push({
        questionId: question.id,
        userAnswer: selectedAnswer,
        correctAnswer: question.correctAnswer,
        isCorrect: isCorrect
      });

      // æ˜¾ç¤ºæ­£ç¡®ç­”æ¡ˆå’Œé”™è¯¯ç­”æ¡ˆ
      const answerOptions = document.querySelectorAll('.answer-option');
      answerOptions.forEach((option, i) => {
        if (i === question.correctAnswer) {
          option.classList.add('correct');
        } else if (i === selectedAnswer && !isCorrect) {
          option.classList.add('wrong');
        }
        option.style.pointerEvents = 'none'; // ç¦ç”¨è¿›ä¸€æ­¥ç‚¹å‡»
      });

      // æ›´æ–°åˆ†æ•°
      if (isCorrect) {
        score += 10;
        correctAnswers++;
        gameMessage.innerHTML = `âœ… å›ç­”æ­£ç¡®ï¼ +10åˆ†<br><small>${question.explanation}</small>`;
        gameMessage.style.color = '#4ecdc4';
        gameMessage.classList.add('feedback-correct');
      } else {
        gameMessage.innerHTML = `âŒ å›ç­”é”™è¯¯ï¼<br><small>æ­£ç¡®ç­”æ¡ˆæ˜¯: ${question.options[question.correctAnswer]}<br>${question.explanation}</small>`;
        gameMessage.style.color = '#ff6b6b';
        gameMessage.classList.add('feedback-wrong');
      }

      // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
      currentScore.textContent = score;
      const currentAccuracy = Math.round((correctAnswers / (currentQuestionIndex + 1)) * 100);
      accuracy.textContent = `${currentAccuracy}%`;

      // æ›´æ”¹æŒ‰é’®çŠ¶æ€
      submitBtn.style.display = 'none';
      nextBtn.style.display = 'block';
      gameActive = false;
    }

    // ==================== ä¸‹ä¸€é¢˜ ====================
    function nextQuestion() {
      // ç§»é™¤åé¦ˆåŠ¨ç”»
      gameMessage.classList.remove('feedback-correct', 'feedback-wrong');

      currentQuestionIndex++;
      if (currentQuestionIndex < brainQuestions.length) {
        loadQuestion(currentQuestionIndex);
        gameActive = true;
      } else {
        completeGame();
      }
    }

    // ==================== å®Œæˆæ¸¸æˆ ====================
    function completeGame() {
      gameActive = false;

      // è®¡ç®—æœ€ç»ˆç»Ÿè®¡æ•°æ®
      const finalAccuracyValue = Math.round((correctAnswers / brainQuestions.length) * 100);
      const finalScoreValue = score;

      // æ›´æ–°å®Œæˆç•Œé¢
      finalScore.textContent = finalScoreValue;
      correctAnswersElement.textContent = `${correctAnswers}/${brainQuestions.length}`;
      finalAccuracy.textContent = `${finalAccuracyValue}%`;

      // æ›´æ–°åˆ†æ•°æ¡
      scoreFill.style.width = `${finalAccuracyValue}%`;
      scoreText.textContent = `${finalAccuracyValue}%`;

      // è®¾ç½®è¯„çº§æ¶ˆæ¯
      let rating = '';
      let title = '';

      if (finalAccuracyValue >= 90) {
        rating = 'ğŸ… å¤§è„‘ä¸“å®¶ï¼ä½ å¯¹å¤§è„‘ç»“æ„äº†å¦‚æŒ‡æŒï¼';
        title = 'å¤ªæ£’äº†ï¼ä½ æ˜¯å¤§è„‘ä¸“å®¶ï¼';
      } else if (finalAccuracyValue >= 70) {
        rating = 'ğŸ¥ˆ éå¸¸å‡ºè‰²ï¼ä½ å¯¹å¤§è„‘æœ‰å¾ˆå¥½çš„ç†è§£ï¼';
        title = 'éå¸¸å‡ºè‰²ï¼';
      } else if (finalAccuracyValue >= 50) {
        rating = 'ğŸ¥‰ ä¸é”™çš„æˆç»©ï¼ç»§ç»­å­¦ä¹ ä¼šæ›´å¥½ï¼';
        title = 'ä¸é”™çš„æˆç»©ï¼';
      } else {
        rating = 'ğŸ“š è¿˜éœ€è¦å¤šå­¦ä¹ å“¦ï¼ŒåŠ æ²¹ï¼';
        title = 'ç»§ç»­åŠ æ²¹ï¼';
      }

      ratingMessage.textContent = rating;
      completionTitle.textContent = title;

      // ç”ŸæˆçŸ¥è¯†æ€»ç»“
      generateKnowledgeSummary();

      // æ˜¾ç¤ºå®Œæˆç•Œé¢
      completionScreen.classList.add('show');
    }

    // ==================== ç”ŸæˆçŸ¥è¯†æ€»ç»“ ====================
    function generateKnowledgeSummary() {
      let summaryHTML = '<ul style="list-style-type: none; padding-left: 0;">';

      // æ‰¾å‡ºç”¨æˆ·ç­”é”™çš„é—®é¢˜
      const wrongAnswers = userAnswers.filter(answer => !answer.isCorrect);

      if (wrongAnswers.length === 0) {
        summaryHTML += '<li style="margin-bottom: 10px;">ğŸ‰ å¤ªå®Œç¾äº†ï¼æ‰€æœ‰é—®é¢˜éƒ½å›ç­”æ­£ç¡®ï¼</li>';
      } else {
        summaryHTML += '<li style="margin-bottom: 15px; color: #a8daff;">ä»¥ä¸‹æ˜¯æ‚¨éœ€è¦å¤ä¹ çš„çŸ¥è¯†ç‚¹ï¼š</li>';

        wrongAnswers.forEach((wrong, index) => {
          const question = brainQuestions.find(q => q.id === wrong.questionId);
          if (question) {
            summaryHTML += `
              <li style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                <strong>é—®é¢˜ ${index + 1}:</strong> ${question.question}<br>
                <span style="color: #ff6b6b;">âŒ æ‚¨çš„ç­”æ¡ˆ: ${question.options[wrong.userAnswer]}</span><br>
                <span style="color: #4ecdc4;">âœ… æ­£ç¡®ç­”æ¡ˆ: ${question.options[question.correctAnswer]}</span><br>
                <small>${question.explanation}</small>
              </li>
            `;
          }
        });
      }

      summaryHTML += '</ul>';
      summaryContent.innerHTML = summaryHTML;
    }

    // ==================== æŒ‰é’®äº‹ä»¶ç›‘å¬ ====================
    document.getElementById('resetGameBtn').addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸¢å¤±ã€‚')) {
        initGame();
      }
    });

    document.getElementById('backBtn').addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦è¿”å›ä¸»é¡µé¢å—ï¼Ÿå½“å‰æ¸¸æˆè¿›åº¦å°†ä¸¢å¤±ã€‚')) {
        returnToMainPage();
      }
    });

    document.getElementById('backBtn2').addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦è¿”å›ä¸»é¡µé¢å—ï¼Ÿ')) {
        returnToMainPage();
      }
    });

    document.getElementById('submitBtn').addEventListener('click', submitAnswer);
    document.getElementById('nextBtn').addEventListener('click', nextQuestion);
    document.getElementById('playAgainBtn').addEventListener('click', initGame);

    // ==================== é”®ç›˜å¿«æ·é”® ====================
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        // å–æ¶ˆé€‰æ‹©
        const selected = document.querySelector('.answer-option.selected');
        if (selected) {
          selected.classList.remove('selected');
          selectedAnswer = null;
          submitBtn.disabled = true;
          gameMessage.textContent = 'é€‰æ‹©å·²å–æ¶ˆï¼Œè¯·é‡æ–°é€‰æ‹©ç­”æ¡ˆ';
        }
      }

      // æ•°å­—é”®1-4é€‰æ‹©ç­”æ¡ˆ
      if (event.key >= '1' && event.key <= '4' && gameActive) {
        const index = parseInt(event.key) - 1;
        const answerOptions = document.querySelectorAll('.answer-option');
        if (index < answerOptions.length) {
          selectAnswer(index, answerOptions[index]);
        }
      }

      // Enteré”®æäº¤ç­”æ¡ˆ
      if (event.key === 'Enter' && submitBtn.style.display !== 'none') {
        if (!submitBtn.disabled) {
          submitAnswer();
        }
      }

      // ç©ºæ ¼é”®æˆ–Né”®ä¸‹ä¸€é¢˜
      if ((event.key === ' ' || event.key === 'n' || event.key === 'N') && nextBtn.style.display !== 'none') {
        nextQuestion();
      }

      // Alt+Hè¿”å›ä¸»é¡µ
      if (event.key === 'h' || event.key === 'H') {
        if (event.altKey) {
          event.preventDefault();
          returnToMainPage();
        }
      }
    });

    // ==================== åˆå§‹åŒ–æ¸¸æˆ ====================
    window.addEventListener('DOMContentLoaded', () => {
      initGame();

      // æ·»åŠ æ¸¸æˆæç¤º
      setTimeout(() => {
        gameMessage.innerHTML = 'æç¤ºï¼šç‚¹å‡»ç­”æ¡ˆé€‰é¡¹è¿›è¡Œé€‰æ‹©ï¼ŒæŒ‰æ•°å­—é”®1-4å¯ä»¥å¿«é€Ÿé€‰æ‹©<br>æŒ‰Enteré”®æäº¤ç­”æ¡ˆï¼ŒæŒ‰ç©ºæ ¼é”®æˆ–Né”®è¿›å…¥ä¸‹ä¸€é¢˜<br>æŒ‰Alt+Hå¯ä»¥å¿«é€Ÿè¿”å›ä¸»é¡µé¢';
      }, 3000);
    });
  </script>
</body>
</html>