<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å¤§è„‘åˆ†åŒºé…å¯¹æ¸¸æˆ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Microsoft Yahei", "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    /* æ¸¸æˆæ ‡é¢˜å’Œè¯´æ˜ */
    .game-header {
      text-align: center;
      margin-bottom: 30px;
      width: 100%;
      max-width: 900px;
    }

    .game-title {
      font-size: 2.8rem;
      color: #ffd700;
      text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
      margin-bottom: 10px;
    }

    .game-subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
      margin-bottom: 20px;
    }

    /* æ¸¸æˆä¿¡æ¯é¢æ¿ */
    .game-info {
      display: flex;
      justify-content: space-between;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 15px 25px;
      margin-bottom: 25px;
      width: 100%;
      max-width: 900px;
    }

    .info-item {
      text-align: center;
    }

    .info-label {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 5px;
    }

    .info-value {
      font-size: 1.8rem;
      font-weight: bold;
      color: #ffd700;
    }

    /* æ¸¸æˆä¸»å®¹å™¨ */
    .game-container {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 900px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
    }

    /* æ¸¸æˆåŒºåŸŸ */
    .game-area {
      display: flex;
      justify-content: space-between;
      gap: 30px;
      margin-bottom: 30px;
    }

    @media (max-width: 768px) {
      .game-area {
        flex-direction: column;
      }
    }

    /* å¡ç‰‡åˆ—è¡¨ */
    .cards-list {
      flex: 1;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 20px;
      min-height: 400px;
    }

    .cards-list h3 {
      text-align: center;
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: #a8daff;
      border-bottom: 2px solid rgba(168, 218, 255, 0.3);
      padding-bottom: 10px;
    }

    /* å¡ç‰‡æ ·å¼ */
    .card {
      background: rgba(255, 255, 255, 0.15);
      margin: 12px 0;
      padding: 15px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
      font-size: 1.1rem;
      position: relative;
    }

    .card:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateX(5px);
    }

    .card.selected {
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      color: #333;
      font-weight: bold;
      border-color: #ffd700;
    }

    .card.matched {
      background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
      color: white;
      cursor: default;
      opacity: 0.7;
    }

    .card.matched::after {
      content: "âœ“";
      position: absolute;
      right: 15px;
      font-size: 1.5rem;
      color: white;
    }

    .card.wrong {
      animation: shake 0.5s;
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    /* æ¸¸æˆæ¶ˆæ¯ */
    .game-message {
      text-align: center;
      font-size: 1.4rem;
      font-weight: bold;
      min-height: 50px;
      color: #ffd700;
      margin: 20px 0;
      padding: 10px;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.2);
    }

    /* æŒ‰é’®æ ·å¼ */
    .game-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .game-btn {
      padding: 12px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .game-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .game-btn:active {
      transform: scale(0.98);
    }

    .game-btn.reset {
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
      color: #333;
    }

    .game-btn.back {
      background: linear-gradient(135deg, #a8daff 0%, #a8daff 100%);
      color: #333;
    }

    /* å®Œæˆç•Œé¢ */
    .completion-screen {
      text-align: center;
      display: none;
      padding: 40px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 20px;
      margin-top: 20px;
    }

    .completion-screen.show {
      display: block;
    }

    .completion-icon {
      font-size: 5rem;
      margin-bottom: 20px;
    }

    .completion-title {
      font-size: 2.5rem;
      color: #ffd700;
      margin-bottom: 20px;
    }

    .completion-stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 30px 0;
    }

    .stat-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px 25px;
      border-radius: 15px;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      color: #ffd700;
    }

    .stat-label {
      font-size: 1rem;
      opacity: 0.8;
    }

    /* è¿›åº¦æ¡ */
    .progress-container {
      width: 100%;
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      margin: 20px 0;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
      width: 0%;
      border-radius: 10px;
      transition: width 0.5s ease;
    }

    /* æ»šåŠ¨æ¡ç¾åŒ– */
    ::-webkit-scrollbar {
      width: 10px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(255, 215, 0, 0.5);
      border-radius: 5px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 215, 0, 0.8);
    }
  </style>
</head>
<body>
  <!-- æ¸¸æˆæ ‡é¢˜å’Œè¯´æ˜ -->
  <div class="game-header">
    <h1 class="game-title">ğŸ§  å¤§è„‘åˆ†åŒºé…å¯¹æ¸¸æˆ</h1>
    <p class="game-subtitle">å°†å¤§è„‘å„åˆ†åŒºåç§°ä¸å®ƒä»¬çš„åŠŸèƒ½æè¿°æ­£ç¡®é…å¯¹ï¼Œæµ‹è¯•ä½ å¯¹å¤§è„‘ç»“æ„çš„äº†è§£ç¨‹åº¦ã€‚</p>
  </div>

  <!-- æ¸¸æˆä¿¡æ¯é¢æ¿ -->
  <div class="game-info">
    <div class="info-item">
      <div class="info-label">å·²åŒ¹é…</div>
      <div class="info-value" id="matchedCount">0/8</div>
    </div>
    <div class="info-item">
      <div class="info-label">ç”¨æ—¶</div>
      <div class="info-value" id="timer">00:00</div>
    </div>
    <div class="info-item">
      <div class="info-label">å°è¯•æ¬¡æ•°</div>
      <div class="info-value" id="attempts">0</div>
    </div>
  </div>

  <!-- æ¸¸æˆä¸»å®¹å™¨ -->
  <div class="game-container">
    <!-- æ¸¸æˆåŒºåŸŸ -->
    <div class="game-area">
      <!-- å·¦ä¾§ï¼šå¤§è„‘åˆ†åŒºåç§° -->
      <div class="cards-list">
        <h3>å¤§è„‘åˆ†åŒºåç§°</h3>
        <div id="regionsList">
          <!-- å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <!-- å³ä¾§ï¼šåŠŸèƒ½æè¿° -->
      <div class="cards-list">
        <h3>åŠŸèƒ½æè¿°</h3>
        <div id="functionsList">
          <!-- å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>
    </div>

    <!-- è¿›åº¦æ¡ -->
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- æ¸¸æˆæ¶ˆæ¯ -->
    <div class="game-message" id="gameMessage">
      è¯·ç‚¹å‡»å·¦ä¾§çš„å¤§è„‘åˆ†åŒºåç§°ï¼Œç„¶åç‚¹å‡»å³ä¾§å¯¹åº”çš„åŠŸèƒ½æè¿°è¿›è¡Œé…å¯¹
    </div>

    <!-- æ¸¸æˆæŒ‰é’® -->
    <div class="game-buttons">
      <button class="game-btn reset" id="resetGameBtn">é‡æ–°å¼€å§‹</button>
      <button class="game-btn back" id="backBtn">è¿”å›ä¸»é¡µé¢</button>
    </div>

    <!-- å®Œæˆç•Œé¢ -->
    <div class="completion-screen" id="completionScreen">
      <div class="completion-icon">ğŸ†</div>
      <h2 class="completion-title">æ­å–œï¼å…¨éƒ¨é…å¯¹æˆåŠŸï¼</h2>
      <p style="font-size: 1.2rem; margin-bottom: 20px;">ä½ å·²æˆåŠŸæŒæ¡å¤§è„‘å„åˆ†åŒºçš„åŸºæœ¬åŠŸèƒ½</p>

      <div class="completion-stats">
        <div class="stat-item">
          <div class="stat-value" id="finalTime">00:00</div>
          <div class="stat-label">ç”¨æ—¶</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="finalAttempts">0</div>
          <div class="stat-label">å°è¯•æ¬¡æ•°</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="accuracy">100%</div>
          <div class="stat-label">å‡†ç¡®ç‡</div>
        </div>
      </div>

      <div class="game-buttons">
        <button class="game-btn reset" id="playAgainBtn">å†ç©ä¸€æ¬¡</button>
        <button class="game-btn back" id="backBtn2">è¿”å›ä¸»é¡µé¢</button>
      </div>
    </div>
  </div>

  <script>
    // ==================== å¤§è„‘åˆ†åŒºæ•°æ® ====================
    const brainRegions = [
      {
        id: 'frontal',
        name: 'é¢å¶',
        function: 'è´Ÿè´£å†³ç­–ã€è®¡åˆ’å’Œè¿åŠ¨æ§åˆ¶'
      },
      {
        id: 'parietal',
        name: 'é¡¶å¶',
        function: 'å¤„ç†è§¦è§‰å’Œç©ºé—´ä¿¡æ¯'
      },
      {
        id: 'temporal',
        name: 'é¢å¶',
        function: 'è´Ÿè´£å¬è§‰å’Œè®°å¿†å½¢æˆ'
      },
      {
        id: 'occipital',
        name: 'æ•å¶',
        function: 'å¤„ç†è§†è§‰ä¿¡æ¯'
      },
      {
        id: 'cerebellum',
        name: 'å°è„‘',
        function: 'åè°ƒè¿åŠ¨å’Œå¹³è¡¡'
      },
      {
        id: 'brainstem',
        name: 'è„‘å¹²',
        function: 'æ§åˆ¶åŸºæœ¬ç”Ÿå‘½åŠŸèƒ½å¦‚å‘¼å¸å’Œå¿ƒè·³'
      },
      {
        id: 'hippocampus',
        name: 'æµ·é©¬ä½“',
        function: 'è´Ÿè´£è®°å¿†å½¢æˆå’Œç©ºé—´å¯¼èˆª'
      },
      {
        id: 'amygdala',
        name: 'æä»æ ¸',
        function: 'å¤„ç†æƒ…ç»ªååº”ç‰¹åˆ«æ˜¯ææƒ§'
      }
    ];

    // ==================== æ¸¸æˆçŠ¶æ€å˜é‡ ====================
    let selectedRegion = null;
    let selectedFunction = null;
    let matchedPairs = 0;
    let attempts = 0;
    let startTime = null;
    let timerInterval = null;
    let gameActive = true;

    // ==================== DOMå…ƒç´ å¼•ç”¨ ====================
    const regionsList = document.getElementById('regionsList');
    const functionsList = document.getElementById('functionsList');
    const gameMessage = document.getElementById('gameMessage');
    const matchedCount = document.getElementById('matchedCount');
    const timerElement = document.getElementById('timer');
    const attemptsElement = document.getElementById('attempts');
    const progressBar = document.getElementById('progressBar');
    const completionScreen = document.getElementById('completionScreen');
    const finalTime = document.getElementById('finalTime');
    const finalAttempts = document.getElementById('finalAttempts');
    const accuracyElement = document.getElementById('accuracy');

    // ==================== è¿”å›ä¸»é¡µé¢çš„å‡½æ•° ====================
    function returnToMainPage() {
      // è·³è½¬åˆ°æŒ‡å®šçš„ä¸»é¡µURL
      const mainPageUrl = 'index.html';

      // å°è¯•å…³é—­å½“å‰çª—å£ï¼ˆå¦‚æœå…è®¸çš„è¯ï¼‰
      try {
        // é¦–å…ˆå°è¯•ç”¨window.openæ‰“å¼€ä¸»é¡µ
        window.open(mainPageUrl, '_self');

        // å»¶è¿Ÿä¸€å°æ®µæ—¶é—´åå°è¯•å…³é—­å½“å‰çª—å£
        setTimeout(() => {
          // æ£€æŸ¥å½“å‰çª—å£æ˜¯å¦å¯ä»¥è¢«å…³é—­
          if (window.opener) {
            // å¦‚æœæœ‰openerï¼Œè¯´æ˜æ˜¯ä»ä¸»é¡µé¢æ‰“å¼€çš„
            window.close();
          } else {
            // å¦‚æœæ²¡æœ‰openerï¼Œå°è¯•ä½¿ç”¨å…¶ä»–æ–¹å¼
            console.log('è¿”å›ä¸»é¡µé¢æˆåŠŸï¼å¦‚æœå½“å‰çª—å£æ²¡æœ‰è‡ªåŠ¨å…³é—­ï¼Œè¯·æ‰‹åŠ¨å…³é—­ã€‚');
          }
        }, 100);
      } catch (error) {
        // å¦‚æœæ— æ³•è‡ªåŠ¨å…³é—­ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯å¹¶è·³è½¬
        console.log('ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæ— æ³•è‡ªåŠ¨å…³é—­çª—å£ã€‚');
        alert('æ­£åœ¨è¿”å›ä¸»é¡µé¢...è¯·æ‰‹åŠ¨å…³é—­æ­¤æ¸¸æˆçª—å£ã€‚');
        window.location.href = mainPageUrl;
      }
    }

    // ==================== æ¸¸æˆåˆå§‹åŒ– ====================
    function initGame() {
      // é‡ç½®æ¸¸æˆçŠ¶æ€
      selectedRegion = null;
      selectedFunction = null;
      matchedPairs = 0;
      attempts = 0;
      gameActive = true;

      // æ›´æ–°æ˜¾ç¤º
      matchedCount.textContent = '0/8';
      attemptsElement.textContent = '0';
      progressBar.style.width = '0%';
      gameMessage.textContent = 'è¯·ç‚¹å‡»å·¦ä¾§çš„å¤§è„‘åˆ†åŒºåç§°ï¼Œç„¶åç‚¹å‡»å³ä¾§å¯¹åº”çš„åŠŸèƒ½æè¿°è¿›è¡Œé…å¯¹';
      gameMessage.style.color = '#ffd700';

      // éšè—å®Œæˆç•Œé¢
      completionScreen.classList.remove('show');

      // æ¸…é™¤å¡ç‰‡åˆ—è¡¨
      regionsList.innerHTML = '';
      functionsList.innerHTML = '';

      // åˆ›å»ºæ‰“ä¹±çš„å¡ç‰‡
      const shuffledRegions = [...brainRegions].sort(() => Math.random() - 0.5);
      const shuffledFunctions = [...brainRegions].sort(() => Math.random() - 0.5);

      // ç”Ÿæˆåˆ†åŒºåç§°å¡ç‰‡
      shuffledRegions.forEach(region => {
        const card = document.createElement('div');
        card.className = 'card';
        card.textContent = region.name;
        card.dataset.id = region.id;
        card.addEventListener('click', () => selectRegion(region.id, card));
        regionsList.appendChild(card);
      });

      // ç”ŸæˆåŠŸèƒ½æè¿°å¡ç‰‡
      shuffledFunctions.forEach(region => {
        const card = document.createElement('div');
        card.className = 'card';
        card.textContent = region.function;
        card.dataset.id = region.id;
        card.addEventListener('click', () => selectFunction(region.id, card));
        functionsList.appendChild(card);
      });

      // å¯åŠ¨è®¡æ—¶å™¨
      startTimer();
    }

    // ==================== è®¡æ—¶å™¨åŠŸèƒ½ ====================
    function startTimer() {
      if (timerInterval) clearInterval(timerInterval);

      startTime = new Date();
      timerElement.textContent = '00:00';

      timerInterval = setInterval(() => {
        const now = new Date();
        const diff = Math.floor((now - startTime) / 1000);
        const minutes = Math.floor(diff / 60).toString().padStart(2, '0');
        const seconds = (diff % 60).toString().padStart(2, '0');
        timerElement.textContent = `${minutes}:${seconds}`;
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    // ==================== æ¸¸æˆé€»è¾‘ ====================
    function selectRegion(regionId, cardElement) {
      if (!gameActive) return;

      // å¦‚æœå·²ç»åŒ¹é…ï¼Œåˆ™ä¸å¯é€‰æ‹©
      if (cardElement.classList.contains('matched')) return;

      // å¦‚æœå·²ç»é€‰æ‹©äº†ç›¸åŒçš„åŒºåŸŸï¼Œåˆ™å–æ¶ˆé€‰æ‹©
      if (selectedRegion === cardElement) {
        cardElement.classList.remove('selected');
        selectedRegion = null;
        gameMessage.textContent = 'é€‰æ‹©å·²å–æ¶ˆï¼Œè¯·é‡æ–°é€‰æ‹©å¤§è„‘åˆ†åŒº';
        return;
      }

      // å–æ¶ˆä¹‹å‰çš„é€‰æ‹©
      if (selectedRegion) {
        selectedRegion.classList.remove('selected');
      }

      // é€‰æ‹©æ–°çš„åŒºåŸŸ
      selectedRegion = cardElement;
      selectedRegion.classList.add('selected');

      // å¦‚æœæœ‰å·²é€‰æ‹©çš„åŠŸèƒ½ï¼Œæ£€æŸ¥æ˜¯å¦åŒ¹é…
      if (selectedFunction) {
        checkMatch();
      } else {
        gameMessage.textContent = `å·²é€‰æ‹©ã€${cardElement.textContent}ã€‘ï¼Œç°åœ¨è¯·é€‰æ‹©å¯¹åº”çš„åŠŸèƒ½æè¿°`;
      }
    }

    function selectFunction(funcId, cardElement) {
      if (!gameActive) return;

      // å¦‚æœå·²ç»åŒ¹é…ï¼Œåˆ™ä¸å¯é€‰æ‹©
      if (cardElement.classList.contains('matched')) return;

      // å¦‚æœå·²ç»é€‰æ‹©äº†ç›¸åŒçš„åŠŸèƒ½ï¼Œåˆ™å–æ¶ˆé€‰æ‹©
      if (selectedFunction === cardElement) {
        cardElement.classList.remove('selected');
        selectedFunction = null;
        gameMessage.textContent = 'é€‰æ‹©å·²å–æ¶ˆï¼Œè¯·é‡æ–°é€‰æ‹©åŠŸèƒ½æè¿°';
        return;
      }

      // å–æ¶ˆä¹‹å‰çš„é€‰æ‹©
      if (selectedFunction) {
        selectedFunction.classList.remove('selected');
      }

      // é€‰æ‹©æ–°çš„åŠŸèƒ½
      selectedFunction = cardElement;
      selectedFunction.classList.add('selected');

      // å¦‚æœæœ‰å·²é€‰æ‹©çš„åŒºåŸŸï¼Œæ£€æŸ¥æ˜¯å¦åŒ¹é…
      if (selectedRegion) {
        checkMatch();
      } else {
        gameMessage.textContent = `å·²é€‰æ‹©ã€${cardElement.textContent}ã€‘ï¼Œç°åœ¨è¯·é€‰æ‹©å¯¹åº”çš„å¤§è„‘åˆ†åŒº`;
      }
    }

    function checkMatch() {
      if (!selectedRegion || !selectedFunction) return;

      attempts++;
      attemptsElement.textContent = attempts;

      // æ£€æŸ¥æ˜¯å¦åŒ¹é…
      if (selectedRegion.dataset.id === selectedFunction.dataset.id) {
        // åŒ¹é…æˆåŠŸ
        selectedRegion.classList.remove('selected');
        selectedFunction.classList.remove('selected');

        selectedRegion.classList.add('matched');
        selectedFunction.classList.add('matched');

        matchedPairs++;
        matchedCount.textContent = `${matchedPairs}/8`;

        // æ›´æ–°è¿›åº¦æ¡
        const progress = (matchedPairs / 8) * 100;
        progressBar.style.width = `${progress}%`;

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        const regionName = selectedRegion.textContent;
        gameMessage.textContent = `âœ¨ é…å¯¹æˆåŠŸï¼ã€${regionName}ã€‘åŒ¹é…æ­£ç¡®ï¼`;
        gameMessage.style.color = '#4ecdc4';

        // é‡ç½®é€‰æ‹©
        selectedRegion = null;
        selectedFunction = null;

        // æ£€æŸ¥æ˜¯å¦å®Œæˆæ¸¸æˆ
        if (matchedPairs === 8) {
          completeGame();
        }
      } else {
        // åŒ¹é…å¤±è´¥
        selectedRegion.classList.add('wrong');
        selectedFunction.classList.add('wrong');

        gameMessage.textContent = 'âŒ é…å¯¹é”™è¯¯ï¼Œè¯·å†è¯•è¯•';
        gameMessage.style.color = '#ff6b6b';

        // çŸ­æš‚å»¶è¿Ÿåé‡ç½®é”™è¯¯çŠ¶æ€
        setTimeout(() => {
          selectedRegion.classList.remove('selected');
          selectedFunction.classList.remove('selected');
          selectedRegion.classList.remove('wrong');
          selectedFunction.classList.remove('wrong');

          selectedRegion = null;
          selectedFunction = null;

          gameMessage.textContent = 'é…å¯¹é”™è¯¯ï¼Œè¯·é‡æ–°é€‰æ‹©';
          gameMessage.style.color = '#ffd700';
        }, 1000);
      }
    }

    function completeGame() {
      gameActive = false;
      stopTimer();

      // è®¡ç®—å‡†ç¡®ç‡
      const accuracy = Math.round((8 / attempts) * 100);

      // æ˜¾ç¤ºå®Œæˆç•Œé¢
      finalTime.textContent = timerElement.textContent;
      finalAttempts.textContent = attempts;
      accuracyElement.textContent = `${accuracy}%`;

      // æ˜¾ç¤ºç¥è´ºæ¶ˆæ¯
      let congratsMessage = '';
      if (attempts <= 8) {
        congratsMessage = 'å¤ªæ£’äº†ï¼ä½ å®Œç¾æŒæ¡äº†å¤§è„‘åˆ†åŒºçŸ¥è¯†ï¼';
      } else if (attempts <= 12) {
        congratsMessage = 'éå¸¸å‡ºè‰²ï¼ä½ å¯¹å¤§è„‘ç»“æ„æœ‰å¾ˆå¥½çš„ç†è§£ï¼';
      } else {
        congratsMessage = 'æ­å–œå®Œæˆï¼ç»§ç»­å­¦ä¹ ä¼šæŒæ¡å¾—æ›´å¥½ï¼';
      }

      gameMessage.textContent = congratsMessage;
      gameMessage.style.color = '#ffd700';

      // æ˜¾ç¤ºå®Œæˆç•Œé¢
      setTimeout(() => {
        completionScreen.classList.add('show');
      }, 1000);
    }

    // ==================== æŒ‰é’®äº‹ä»¶ç›‘å¬ ====================
    document.getElementById('resetGameBtn').addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸¢å¤±ã€‚')) {
        initGame();
      }
    });

    // ä¸»æŒ‰é’®åŒºçš„è¿”å›æŒ‰é’®
    document.getElementById('backBtn').addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦è¿”å›ä¸»é¡µé¢å—ï¼Ÿå½“å‰æ¸¸æˆè¿›åº¦å°†ä¸¢å¤±ã€‚')) {
        returnToMainPage();
      }
    });

    // å®Œæˆç•Œé¢çš„è¿”å›æŒ‰é’®
    document.getElementById('backBtn2').addEventListener('click', () => {
      if (confirm('ç¡®å®šè¦è¿”å›ä¸»é¡µé¢å—ï¼Ÿ')) {
        returnToMainPage();
      }
    });

    document.getElementById('playAgainBtn').addEventListener('click', () => {
      initGame();
    });

    // ==================== é”®ç›˜å¿«æ·é”® ====================
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        if (selectedRegion) {
          selectedRegion.classList.remove('selected');
          selectedRegion = null;
        }
        if (selectedFunction) {
          selectedFunction.classList.remove('selected');
          selectedFunction = null;
        }
        gameMessage.textContent = 'é€‰æ‹©å·²å–æ¶ˆï¼Œè¯·é‡æ–°å¼€å§‹é…å¯¹';
      }

      if (event.key === 'r' || event.key === 'R') {
        if (event.ctrlKey) {
          initGame();
        }
      }

      // æ·»åŠ è¿”å›ä¸»é¡µçš„å¿«æ·é”® (Alt + H)
      if (event.key === 'h' || event.key === 'H') {
        if (event.altKey) {
          event.preventDefault();
          returnToMainPage();
        }
      }
    });

    // ==================== åˆå§‹åŒ–æ¸¸æˆ ====================
    window.addEventListener('DOMContentLoaded', () => {
      initGame();

      // æ·»åŠ ä¸€äº›æ¸¸æˆæç¤º
      setTimeout(() => {
        gameMessage.innerHTML = 'æç¤ºï¼šç‚¹å‡»å·¦ä¾§çš„å¤§è„‘åˆ†åŒºåç§°ï¼Œç„¶åç‚¹å‡»å³ä¾§å¯¹åº”çš„åŠŸèƒ½æè¿°è¿›è¡Œé…å¯¹<br>æŒ‰ESCé”®å¯ä»¥å–æ¶ˆå½“å‰é€‰æ‹©ï¼ŒæŒ‰Alt+Hå¯ä»¥å¿«é€Ÿè¿”å›ä¸»é¡µé¢';
      }, 3000);
    });
  </script>
</body>
</html>